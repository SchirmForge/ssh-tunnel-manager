# SSH Tunnel Manager - v0.1.8 Release

**Release Date**: 2025-12-26
**Status**: First Public Release - Production Ready for Local Port Forwarding

## Overview

SSH Tunnel Manager is a comprehensive SSH tunnel management application for Linux with three components:
- **Daemon** - Background service managing SSH connections
- **CLI** - Command-line interface for tunnel control
- **GUI** - Modern GTK4/Libadwaita graphical interface

This first release provides a stable foundation for managing SSH local port forwarding tunnels with interactive authentication, real-time status updates, and comprehensive security features.

## What Works

### ‚úÖ Core Functionality

**SSH Tunnel Management**
- ‚úÖ Local port forwarding (`ssh -L`) fully implemented
- ‚úÖ Interactive authentication (password, SSH key passphrase, keyboard-interactive/2FA)
- ‚úÖ SSH host key verification with OpenSSH-compatible known_hosts
- ‚úÖ Real-time connection status via Server-Sent Events (SSE)
- ‚úÖ Profile-based configuration with TOML persistence
- ‚úÖ System keyring integration for credential storage

**Daemon**
- ‚úÖ Three operational modes: Unix socket (default), TCP HTTP (localhost), TCP HTTPS (network)
- ‚úÖ Token-based authentication (enabled by default)
- ‚úÖ Self-signed TLS certificate generation with fingerprint pinning
- ‚úÖ Graceful shutdown with proper cleanup
- ‚úÖ PID file locking prevents duplicate instances
- ‚úÖ REST API and SSE endpoint for tunnel control
- ‚úÖ Daemon info API (`/api/daemon/info`) with comprehensive metadata
- ‚úÖ Graceful daemon shutdown via API

**CLI**
- ‚úÖ Profile management (add, list, show, delete, info)
- ‚úÖ Tunnel control (start, stop, restart, status)
- ‚úÖ Batch operations (stop --all, status --all)
- ‚úÖ Interactive prompts and non-interactive flags
- ‚úÖ Daemon introspection (info, dump-config commands)
- ‚úÖ Proactive config validation with helpful error messages
- ‚úÖ Interactive daemon config snippet copy
- ‚úÖ Color-coded output and formatted tables
- ‚úÖ JSON output mode for scripting

**GUI**
- ‚úÖ Modern Libadwaita/GTK4 interface
- ‚úÖ Two-page navigation (Client profiles and Daemon status)
- ‚úÖ Full profile CRUD (create, edit, delete)
- ‚úÖ Real-time status indicators (colored dots: green/orange/red/gray)
- ‚úÖ Daemon connection monitoring with auto-reconnect
- ‚úÖ Authentication dialogs for interactive prompts
- ‚úÖ Comprehensive daemon status page with real-time info
- ‚úÖ Client configuration viewer (read-only)
- ‚úÖ Help and About dialogs with markdown rendering
- ‚úÖ Advanced tunnel options (compression, keepalive, packet sizes)

**Security**
- ‚úÖ Authentication enabled by default for all modes
- ‚úÖ HTTP mode restricted to loopback addresses only
- ‚úÖ Network access requires HTTPS with certificate pinning
- ‚úÖ File permissions hardening (0600 for sensitive files)
- ‚úÖ Restrictive umask (0077) prevents permission leaks
- ‚úÖ SSH host key verification prevents MITM attacks
- ‚úÖ Credentials stored in OS keyring (not on disk)
- ‚úÖ Optional group access mode for shared daemons

**Headless/Server Support**
- ‚úÖ Graceful keyring fallback when unavailable
- ‚úÖ `SSH_TUNNEL_SKIP_KEYRING` environment variable
- ‚úÖ Profile creation succeeds without keyring
- ‚úÖ Comprehensive systemd integration documentation

## Known Limitations & Missing Features

### ‚ùå Not Yet Implemented

**Tunnel Types**
- ‚ùå Remote port forwarding (`ssh -R`) - Planned for v0.2.0
- ‚ùå Dynamic/SOCKS proxy (`ssh -D`) - Planned for v0.2.0
- ‚ùå Auto-reconnect/health monitoring - Config exists but not wired
  - Options present in profile configuration but not implemented
  - Manual restart required when connections drop

**GUI Features**
- ‚ùå System tray integration - No background GUI mode yet
- ‚ùå Desktop notifications - `notify-rust` dependency present but unused
- ‚ùå Dark mode auto-selection - Currently follows system theme but no manual toggle
- ‚ùå Daemon autostart configuration via GUI - Must use systemctl manually
- ‚ùå Profile autostart configuration - Not implemented

**CLI Features**
- ‚ùå No automatic log rotation for daemon logs
- ‚ùå Configurable daemon config path - Currently hardcoded to `~/.config/ssh-tunnel-manager/daemon.toml`
- ‚ùå No structured logging (JSON) option

**Authentication**
- ‚ùå Remote host password storage - Only SSH key passphrase is stored
  - Keyboard-interactive and password auth require manual entry each time
  - Only SSH key passphrases can be stored in keyring

**System Integration**
- ‚ùå No official packages yet (Flatpak, AUR, .deb, AppImage)
- ‚ùå No autostart on login (systemd user service exists but manual setup required)

## Known Bugs

### üîß Minor Issues

**GUI**
- The Client navigation link changes color when navigating between pages.

### üêõ Active Issues

**Testing**
- ‚ö†Ô∏è Tests in `crates/common` are outdated due to schema drift
  - Profile manager tests need updating for current ProfileMetadata structure
  - Daemon client tests need updating for new field structure
  - All other crates have passing tests

**Edge Cases**
- ‚ö†Ô∏è 60-second timeout when canceling tunnel during auth phase with no GUI client connected
  - Daemon waits for auth response that never comes
  - Workaround: Use GUI or CLI to cancel tunnels properly
- ‚ö†Ô∏è Token exposure risk in CLI config snippet
  - `cli-config.snippet` contains plaintext auth token
  - File has 0600 permissions but still visible in filesystem

**Documentation Gaps**
- ‚ö†Ô∏è No migration guide for upgrading between versions
- ‚ö†Ô∏è Limited troubleshooting documentation for network modes
- ‚ö†Ô∏è Missing architecture diagrams for SSE event flow

### Quick Start

```bash
# Start the daemon (if not using systemd)
ssh-tunnel-daemon &

# Or start the daemon with systemd
systemctl start --user ssh-tunnel-daemon

# Create a profile (see additional options or use the gui for a more complex setup)
ssh-tunnel add myserver \
  --host example.com \
  --user myuser \
  --key ~/.ssh/id_ed25519 \
  --local-port 8080 \
  --remote-host localhost \
  --remote-port 80

# Start the tunnel
ssh-tunnel start myserver

# Check status
ssh-tunnel status myserver

# Or use the GUI
ssh-tunnel-gui
```

## System Requirements

**Platform**
- Linux (x86_64, aarch64)
- systemd (optional, for service management)
- D-Bus session bus (for keyring access)

**Runtime Dependencies**
- GTK4 ‚â• 4.10
- libadwaita ‚â• 1.4
- Secret Service API provider (gnome-keyring, KDE Wallet, or compatible)
- OpenSSH-compatible SSH server (remote)

**Build Dependencies**
- Rust ‚â• 1.75
- cargo
- GTK4 development libraries
- libadwaita development libraries
- pkg-config

## Upgrade Notes

This is the first public release. Future versions will include migration notes here.

### Configuration Compatibility

Current configuration format:
- **Daemon config**: `~/.config/ssh-tunnel-manager/daemon.toml`
- **CLI config**: `~/.config/ssh-tunnel-manager/cli.toml`
- **Profile configs**: `~/.config/ssh-tunnel-manager/profiles/*.toml`
- **Known hosts**: `~/.config/ssh-tunnel-manager/known_hosts`

All configuration files use TOML format and include automatic migration for minor schema changes.

## Security Considerations

### Default Security Posture

‚úÖ **Secure by Default**
- Authentication required for all daemon modes
- HTTP mode restricted to localhost only
- Network access requires HTTPS + certificate pinning
- All sensitive files created with 0600 permissions
- Umask set to 0077 to prevent permission leaks

### Recommended Setup

For **local-only use** (most secure):
```toml
# daemon.toml
listener_mode = "unix-socket"  # Default
require_auth = true            # Default
```

For **network use** (e.g., remote GUI):
```toml
# daemon.toml
listener_mode = "tcp-https"
require_auth = true
bind_host = "0.0.0.0"
bind_port = 3443
```

‚ö†Ô∏è **Never use HTTP mode over network** - It's restricted to loopback for security reasons.

### Threat Model

**Protected Against**
‚úÖ MITM attacks (TLS certificate pinning in HTTPS mode)
‚úÖ Unauthorized daemon access (token authentication)
‚úÖ SSH host key spoofing (known_hosts verification)
‚úÖ Credential theft from disk (keyring storage)
‚úÖ Permission leaks (restrictive umask and file permissions)

**Not Protected Against**
‚ö†Ô∏è Malicious processes running as the same user (by design - Unix permission model)
  - Any process running as your user can access your Unix socket and config files
  - This is the intended Unix security model - we trust processes running as the same user
‚ö†Ô∏è Keyloggers or memory dumping (credentials in memory during use)
‚ö†Ô∏è Compromised SSH servers on first connect (host key verification trusts first connection)

## Troubleshooting

### Daemon won't start
```bash
# Check if already running
ps aux | grep ssh-tunnel-daemon

# Check PID file
cat /run/user/$(id -u)/ssh-tunnel-manager/daemon.pid

# Remove stale PID file if needed
rm /run/user/$(id -u)/ssh-tunnel-manager/daemon.pid
```

### GUI shows "Daemon Disconnected"
```bash
# Check daemon status
systemctl --user status ssh-tunnel-daemon

# View daemon logs
journalctl --user -u ssh-tunnel-daemon -f

# Restart daemon
systemctl --user restart ssh-tunnel-daemon
```

### Authentication failures (401 errors)
```bash
# Validate config
ssh-tunnel dump-config

# Copy daemon config snippet (if missing)
ssh-tunnel start <profile>  # Will prompt to copy snippet

# Check auth token matches
cat ~/.config/ssh-tunnel-manager/daemon.token
grep auth_token ~/.config/ssh-tunnel-manager/cli.toml
```

### Keyring unavailable on headless server
```bash
# Skip keyring for this session
export SSH_TUNNEL_SKIP_KEYRING=1

# Or permanently configure profile without keyring
ssh-tunnel add myserver --host example.com --user myuser --key ~/.ssh/id_ed25519
# When prompted for passphrase, leave empty if key is unencrypted
```

## Contributing

This is the first public release. Contributions welcome for:
- Remote port forwarding implementation
- Dynamic/SOCKS proxy implementation
- Package creation (Flatpak, AUR, .deb)
- Documentation improvements
- Bug fixes and testing

## License

Apache-2.0

## Credits

Developed with assistance from Generative AI.

---

**Full Changelog**: See [CHANGELOG.md](CHANGELOG.md) for detailed version history.

**Project Status**: See [docs/PROJECT_STATUS.md](docs/PROJECT_STATUS.md) for roadmap and implementation details.
